<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - MonieKing</title>
  <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  
  <!-- MKoin Token Display -->
  <div class="mkoin-display" onclick="window.location.href='mkoin.html'" title="Your MKoin Balance">
    <div class="mkoin-icon">M</div>
    <div>
      <div class="mkoin-balance" id="mkoinBalance">0.00</div>
      <div class="mkoin-label">MKoin</div>
    </div>
  </div>
  
  <!-- Dark Mode Toggle -->
  <button class="dark-mode-toggle" id="darkModeToggle" title="Toggle Dark Mode">
    <span class="sun-icon">â˜€ï¸</span>
    <span class="moon-icon hidden">ğŸŒ™</span>
  </button>
  
  <!-- App Header with Logo, Slogan & Profile -->
  <header class="app-header">
    <div class="logo-area">
      <img src="images/logo.png" alt="MonieKing" class="app-logo-img">
      <div class="slogan-area-mobile">
        <div class="slogan-text" id="headerSlogan"></div>
      </div>
    </div>
    <div class="profile-area" onclick="window.location.href='settings.html'">
      <div class="profile-avatar" id="profileAvatar">W</div>
      <div class="profile-info">
        <div class="profile-name" id="profileName">Wisdom</div>
        <div class="profile-status">
          <span class="status-dot"></span>
          <span>Active</span>
        </div>
      </div>
    </div>
  </header>
  
  <div class="page">
    <div class="dashboard-welcome">
      <h1 class="welcome-title">Welcome back, <span id="userName">User</span>! ğŸ‘‹</h1>
      <p class="welcome-subtitle">Here's your financial overview</p>
    </div>
    
    <div class="page-content">
      <!-- Virtual Debit Card -->
      <div class="card-scene" id="cardScene">
        <div class="virtual-card" id="virtualCard">
          <div class="card-front">
            <div class="card-chip">ğŸ’³</div>
            <img src="images/logo.png" alt="MonieKing" class="card-logo-img">
            <div class="card-number" id="cardNumber">**** **** **** 7890</div>
            <div class="card-details">
              <div class="card-holder">
                <div class="card-label">Card Holder</div>
                <div class="card-value" id="cardHolderName">WISDOM OKECHUKWU</div>
              </div>
              <div class="card-expiry">
                <div class="card-label">Expires</div>
                <div class="card-value">12/28</div>
              </div>
            </div>
          </div>
          <div class="card-back">
            <div class="card-balance-container">
              <div class="card-balance-label">Total Balance</div>
              <div class="card-balance-amount" id="cardBalance">$0.00</div>
              <div class="card-balance-hint">Tap to hide balance</div>
            </div>
            <div class="card-cvv">
              <div class="card-label">CVV</div>
              <div class="card-value">***</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Wallets Grid -->
      <div style="margin-bottom: var(--spacing-lg);">
        <h3 style="margin-bottom: var(--spacing-md);">My Wallets</h3>
        <div class="wallet-grid" id="walletGrid">
          <!-- Wallets will be loaded here -->
        </div>
      </div>
      
      <!-- Quick Actions -->
      <div style="margin-bottom: var(--spacing-xl);">
        <h3 style="margin-bottom: var(--spacing-md);">Quick Actions</h3>
        <div class="quick-actions">
          <a href="#" onclick="showAlert('Coming soon!', 'info'); return false;" class="action-btn">
            <div class="action-icon">ğŸ’°</div>
            <div class="action-label">Add Money</div>
          </a>
          <a href="send-money.html" class="action-btn">
            <div class="action-icon">ğŸ“¤</div>
            <div class="action-label">Send</div>
          </a>
          <a href="receive-money.html" class="action-btn">
            <div class="action-icon">ğŸ“¥</div>
            <div class="action-label">Receive</div>
          </a>
          <a href="convert.html" class="action-btn">
            <div class="action-icon">ğŸ”„</div>
            <div class="action-label">Convert</div>
          </a>
          <a href="shop.html" class="action-btn">
            <div class="action-icon">ğŸ›ï¸</div>
            <div class="action-label">Shop</div>
          </a>
        </div>
      </div>
      
      <!-- Recent Transactions -->
      <div style="margin-bottom: var(--spacing-xl);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-md);">
          <h3>Recent Transactions</h3>
          <a href="transactions.html" style="font-size: 0.875rem; color: var(--primary-blue); font-weight: 600;">View All â†’</a>
        </div>
        
        <div class="transaction-list" id="recentTransactions">
          <!-- Transactions will be loaded here -->
        </div>
      </div>
    </div>
    
    <!-- Bottom Navigation -->
    <div id="bottomNav"></div>
  </div>
  
  <script src="js/mock-data.js"></script>
  <script src="js/components.js"></script>
  <script src="js/app.js"></script>
  <script>
    // Check if user is logged in
    if (!localStorage.getItem('isLoggedIn')) {
      window.location.href = 'login.html';
    }
    
    // Dark Mode Toggle
    const darkModeToggle = document.getElementById('darkModeToggle');
    const body = document.body;
    const sunIcon = darkModeToggle.querySelector('.sun-icon');
    const moonIcon = darkModeToggle.querySelector('.moon-icon');
    
    // Check for saved dark mode preference
    if (localStorage.getItem('darkMode') === 'enabled') {
      body.classList.add('dark-mode');
      sunIcon.classList.add('hidden');
      moonIcon.classList.remove('hidden');
    }
    
    darkModeToggle.addEventListener('click', () => {
      body.classList.toggle('dark-mode');
      
      if (body.classList.contains('dark-mode')) {
        localStorage.setItem('darkMode', 'enabled');
        sunIcon.classList.add('hidden');
        moonIcon.classList.remove('hidden');
      } else {
        localStorage.setItem('darkMode', 'disabled');
        sunIcon.classList.remove('hidden');
        moonIcon.classList.add('hidden');
      }
    });
    
    // Initialize header slogan typing
    initHeaderSloganTyping();
    
    // Load user data
    const userName = localStorage.getItem('userName') || user.name;
    const userInitial = userName.charAt(0).toUpperCase();
    
    document.getElementById('userName').textContent = userName.split(' ')[0];
    document.getElementById('profileName').textContent = userName.split(' ')[0];
    document.getElementById('profileAvatar').textContent = userInitial;
    
    // Load MKoin balance
    const mkoinBalance = parseFloat(localStorage.getItem('mkoinBalance') || '0');
    document.getElementById('mkoinBalance').textContent = mkoinBalance.toFixed(2);
    
    // Load total balance
    const totalBalance = user.totalBalanceUSD;
    document.getElementById('cardBalance').textContent = formatCurrency(totalBalance, 'USD');
    
    // Set card holder name
    document.getElementById('cardHolderName').textContent = userName.toUpperCase();
    
    // ===== 3D CARD ANIMATION =====
    const cardScene = document.getElementById('cardScene');
    const virtualCard = document.getElementById('virtualCard');
    let isFlipped = false;
    let autoFlipTimer = null;
    let hasManuallyFlipped = false;
    let isHovering = false;
    
    // Card theme variations
    const cardThemes = [
      'glass', 'gradient', 'metallic', 'neon', 'pastel', 
      'carbon', 'royal', 'emerald', 'sunset', 'whitegold'
    ];
    
    // Assign random theme (or get from localStorage)
    let userTheme = localStorage.getItem('cardTheme');
    if (!userTheme) {
      userTheme = cardThemes[Math.floor(Math.random() * cardThemes.length)];
      localStorage.setItem('cardTheme', userTheme);
    }
    virtualCard.classList.add(userTheme);
    
    // Click to flip card - FIXED for first time users
    virtualCard.addEventListener('click', function(e) {
      e.preventDefault();
      e.stopPropagation();
      isFlipped = !isFlipped;
      
      if (isFlipped) {
        virtualCard.classList.add('flipped');
        virtualCard.style.transform = 'rotateY(180deg)';
      } else {
        virtualCard.classList.remove('flipped');
        virtualCard.style.transform = 'rotateY(0deg)';
      }
      
      hasManuallyFlipped = true;
      clearTimeout(autoFlipTimer);
    });
    
    // Desktop: 3D tilt effect on hover
    if (window.innerWidth > 768) {
      cardScene.addEventListener('mouseenter', function() {
        isHovering = true;
      });
      
      cardScene.addEventListener('mousemove', function(e) {
        if (!isFlipped && isHovering) {
          const rect = cardScene.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;
          
          const rotateX = ((y - centerY) / 10);
          const rotateY = ((centerX - x) / 10);
          
          virtualCard.style.transform = `perspective(1000px) rotateX(${-rotateX}deg) rotateY(${rotateY}deg)`;
        }
      });
      
      cardScene.addEventListener('mouseleave', function() {
        isHovering = false;
        if (!isFlipped) {
          virtualCard.style.transform = 'perspective(1000px) rotateX(0) rotateY(0)';
        }
      });
    }
    
    // Auto-flip every 10 seconds (only if user hasn't manually flipped)
    function startAutoFlip() {
      if (!hasManuallyFlipped) {
        autoFlipTimer = setTimeout(() => {
          virtualCard.classList.add('flipped');
          virtualCard.style.transform = 'rotateY(180deg)';
          setTimeout(() => {
            virtualCard.classList.remove('flipped');
            virtualCard.style.transform = 'rotateY(0deg)';
            startAutoFlip();
          }, 3000);
        }, 10000);
      }
    }
    
    startAutoFlip();
    
    // Load wallets
    const walletGrid = document.getElementById('walletGrid');
    walletGrid.innerHTML = user.wallets.map(wallet => createWalletCard(wallet)).join('');
    
    // Load recent transactions (last 5)
    const recentTransactions = document.getElementById('recentTransactions');
    const transactions = user.transactions.slice(0, 5);
    recentTransactions.innerHTML = transactions.map(tx => createTransactionItem(tx)).join('');
    
    // Load bottom navigation
    document.getElementById('bottomNav').innerHTML = createBottomNav('dashboard');
    
    // Transaction details modal
    window.showTransactionDetails = function(id) {
      const transaction = user.transactions.find(tx => tx.id === id);
      if (!transaction) return;
      
      const content = `
        <div style="text-align: center;">
          <div class="transaction-icon ${transaction.type.toLowerCase()}" style="width: 60px; height: 60px; font-size: 2rem; margin: 0 auto 1rem;">
            ${getTransactionIcon(transaction.type)}
          </div>
          <h3>${transaction.type}</h3>
          <div style="font-size: 2rem; font-weight: 700; color: var(--primary-blue); margin: 1rem 0;">
            ${formatCurrency(transaction.amount, transaction.currency)}
          </div>
          <div class="card" style="text-align: left; margin-top: 1.5rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
              <span class="text-muted">Status:</span>
              <span class="transaction-status ${transaction.status.toLowerCase()}">${transaction.status}</span>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
              <span class="text-muted">Date:</span>
              <span class="font-semibold">${formatDate(transaction.date)}</span>
            </div>
            ${transaction.recipient ? `
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                <span class="text-muted">Recipient:</span>
                <span class="font-semibold">${transaction.recipient}</span>
              </div>
            ` : ''}
            ${transaction.sender ? `
              <div style="display: flex; justify-content: space-between; margin-bottom: 0.75rem;">
                <span class="text-muted">Sender:</span>
                <span class="font-semibold">${transaction.sender}</span>
              </div>
            ` : ''}
            <div style="display: flex; justify-content: space-between;">
              <span class="text-muted">Description:</span>
              <span class="font-semibold">${transaction.description}</span>
            </div>
          </div>
        </div>
      `;
      
      showModal('Transaction Details', content, [
        { text: 'Close', class: 'btn btn-outline' }
      ]);
    };
  </script>
</body>
</html>