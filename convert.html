<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Convert Currency - MonieKing</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  
  <div class="page">
    <div class="page-header">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <a href="dashboard.html" style="font-size: 1.5rem;">‚Üê</a>
        <div>
          <div class="header-greeting">Convert Currency</div>
          <div class="header-subtitle">Exchange between your wallets</div>
        </div>
      </div>
    </div>
    
    <div class="page-content">
      <!-- Converter Card -->
      <div class="card mb-lg">
        <div style="text-align: center; margin-bottom: 2rem;">
          <div style="font-size: 3rem; margin-bottom: 0.5rem;">üí±</div>
          <h3>Currency Converter</h3>
        </div>
        
        <!-- From Currency -->
        <div class="form-group">
          <label class="form-label">From</label>
          <div style="display: flex; gap: 0.5rem;">
            <input type="number" class="form-input" placeholder="0.00" id="fromAmount" step="0.01" min="0.01" oninput="convertCurrency()" required>
            <select class="form-select" id="fromCurrency" style="max-width: 120px;" onchange="convertCurrency()">
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="GBP">GBP</option>
              <option value="NGN">NGN</option>
            </select>
          </div>
          <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-muted);">
            Available: <span id="fromBalance" class="font-semibold">$0.00</span>
          </div>
        </div>
        
        <!-- Swap Button -->
        <div style="text-align: center; margin: 1rem 0;">
          <button type="button" class="btn btn-outline" style="border-radius: 50%; width: 48px; height: 48px; padding: 0;" onclick="swapCurrencies()">
            ‚ÜïÔ∏è
          </button>
        </div>
        
        <!-- To Currency -->
        <div class="form-group">
          <label class="form-label">To</label>
          <div style="display: flex; gap: 0.5rem;">
            <input type="number" class="form-input" placeholder="0.00" id="toAmount" readonly>
            <select class="form-select" id="toCurrency" style="max-width: 120px;" onchange="convertCurrency()">
              <option value="EUR">EUR</option>
              <option value="USD">USD</option>
              <option value="GBP">GBP</option>
              <option value="NGN">NGN</option>
            </select>
          </div>
          <div style="margin-top: 0.5rem; font-size: 0.875rem; color: var(--text-muted);">
            Available: <span id="toBalance" class="font-semibold">‚Ç¨0.00</span>
          </div>
        </div>
        
        <!-- Exchange Rate Info -->
        <div id="rateInfo" class="rate-card hidden">
          <div class="rate-row">
            <span class="rate-label">Exchange Rate</span>
            <span class="rate-value" id="currentRate">-</span>
          </div>
          <div class="rate-row">
            <span class="rate-label">Conversion Fee (1.5%)</span>
            <span class="rate-value" id="conversionFee">-</span>
          </div>
          <div class="rate-row" style="border-top: 2px solid #CBD5E1; padding-top: 0.75rem; margin-top: 0.75rem;">
            <span class="rate-label font-semibold">You'll Receive</span>
            <span class="rate-value font-bold text-primary" id="finalAmount" style="font-size: 1.125rem;">-</span>
          </div>
          <div style="margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #E2E8F0; font-size: 0.75rem; color: var(--text-muted); text-align: center;">
            Last updated: <span id="lastUpdated">-</span>
          </div>
        </div>
        
        <button type="button" class="btn btn-primary btn-block btn-lg mt-lg" onclick="executeConversion()">
          Convert Now
        </button>
      </div>
      
      <!-- Recent Conversions -->
      <div class="card">
        <h3 class="mb-md">Recent Conversions</h3>
        <div id="recentConversions">
          <!-- Will be populated with conversion history -->
        </div>
      </div>
    </div>
    
    <div id="bottomNav"></div>
  </div>
  
  <script src="js/mock-data.js"></script>
  <script src="js/components.js"></script>
  <script src="js/app.js"></script>
  <script>
    // Check login
    if (!localStorage.getItem('isLoggedIn')) {
      window.location.href = 'login.html';
    }
    
    // Update balances
    function updateBalances() {
      const fromCurrency = document.getElementById('fromCurrency').value;
      const toCurrency = document.getElementById('toCurrency').value;
      
      const fromWallet = user.wallets.find(w => w.currency === fromCurrency);
      const toWallet = user.wallets.find(w => w.currency === toCurrency);
      
      if (fromWallet) {
        document.getElementById('fromBalance').textContent = formatCurrency(fromWallet.balance, fromCurrency);
      }
      
      if (toWallet) {
        document.getElementById('toBalance').textContent = formatCurrency(toWallet.balance, toCurrency);
      }
    }
    
    // Convert currency
    function convertCurrency() {
      const fromAmount = parseFloat(document.getElementById('fromAmount').value);
      const fromCurrency = document.getElementById('fromCurrency').value;
      const toCurrency = document.getElementById('toCurrency').value;
      
      if (!fromAmount || fromAmount <= 0) {
        document.getElementById('rateInfo').classList.add('hidden');
        document.getElementById('toAmount').value = '';
        return;
      }
      
      // Get exchange rate
      const rate = getConversionRate(fromCurrency, toCurrency);
      const fee = calculateFee(fromAmount);
      const convertedAmount = fromAmount * rate;
      const finalAmount = convertedAmount - (fee * rate);
      
      // Update UI
      document.getElementById('toAmount').value = convertedAmount.toFixed(2);
      document.getElementById('currentRate').textContent = `1 ${fromCurrency} = ${rate.toFixed(4)} ${toCurrency}`;
      document.getElementById('conversionFee').textContent = formatCurrency(fee, fromCurrency);
      document.getElementById('finalAmount').textContent = formatCurrency(finalAmount, toCurrency);
      document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
      document.getElementById('rateInfo').classList.remove('hidden');
      
      updateBalances();
    }
    
    // Swap currencies
    function swapCurrencies() {
      const fromCurrency = document.getElementById('fromCurrency').value;
      const toCurrency = document.getElementById('toCurrency').value;
      
      document.getElementById('fromCurrency').value = toCurrency;
      document.getElementById('toCurrency').value = fromCurrency;
      
      document.getElementById('fromAmount').value = '';
      document.getElementById('toAmount').value = '';
      document.getElementById('rateInfo').classList.add('hidden');
      
      updateBalances();
    }
    
    // Execute conversion
    function executeConversion() {
      const fromAmount = parseFloat(document.getElementById('fromAmount').value);
      const fromCurrency = document.getElementById('fromCurrency').value;
      const toCurrency = document.getElementById('toCurrency').value;
      const toAmount = document.getElementById('toAmount').value;
      
      if (!fromAmount || !toAmount) {
        showAlert('Please enter an amount to convert', 'error');
        return;
      }
      
      // Check balance
      const fromWallet = user.wallets.find(w => w.currency === fromCurrency);
      if (fromWallet && fromAmount > fromWallet.balance) {
        showAlert('Insufficient balance', 'error');
        return;
      }
      
      showLoader();
      
      setTimeout(() => {
        hideLoader();
        
        // Animate success
        const content = `
          <div style="text-align: center;">
            <div style="font-size: 4rem; margin-bottom: 1rem;">
              <span class="fade-in">üí±</span>
            </div>
            <h3 class="mb-md">Conversion Successful!</h3>
            <div class="card" style="background: linear-gradient(135deg, #F8FAFC 0%, #E2E8F0 100%);">
              <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                <div>
                  <div class="text-muted text-sm">You Sent</div>
                  <div class="font-bold text-lg">${formatCurrency(fromAmount, fromCurrency)}</div>
                </div>
                <div style="font-size: 1.5rem; color: var(--text-muted);">‚Üí</div>
                <div>
                  <div class="text-muted text-sm">You Received</div>
                  <div class="font-bold text-lg text-primary">${formatCurrency(parseFloat(toAmount), toCurrency)}</div>
                </div>
              </div>
              <div style="font-size: 0.75rem; color: var(--text-muted); text-align: center;">
                Transaction ID: ${generateTransactionId()}
              </div>
            </div>
          </div>
        `;
        
        showModal('Conversion Complete', content, [
          { text: 'Done', class: 'btn btn-primary', onClick: () => {
            document.getElementById('fromAmount').value = '';
            document.getElementById('toAmount').value = '';
            document.getElementById('rateInfo').classList.add('hidden');
            loadRecentConversions();
          }}
        ]);
      }, 2000);
    }
    
    // Load recent conversions
    function loadRecentConversions() {
      const conversions = user.transactions.filter(tx => tx.type === 'Convert').slice(0, 3);
      const container = document.getElementById('recentConversions');
      
      if (conversions.length === 0) {
        container.innerHTML = '<p class="text-muted text-sm text-center">No recent conversions</p>';
        return;
      }
      
      container.innerHTML = conversions.map(conv => `
        <div style="display: flex; justify-content: space-between; padding: 0.75rem 0; border-bottom: 1px solid #F1F5F9;">
          <div>
            <div class="font-semibold text-sm">${conv.from || 'USD'} ‚Üí ${conv.to || 'EUR'}</div>
            <div class="text-muted text-xs">${formatDate(conv.date)}</div>
          </div>
          <div class="text-right">
            <div class="font-semibold text-sm">${formatCurrency(conv.amount, conv.currency)}</div>
            <span class="transaction-status ${conv.status.toLowerCase()}">${conv.status}</span>
          </div>
        </div>
      `).join('');
    }
    
    // Initialize
    updateBalances();
    loadRecentConversions();
    
    // Load bottom nav
    document.getElementById('bottomNav').innerHTML = createBottomNav('dashboard');
  </script>
</body>
</html>